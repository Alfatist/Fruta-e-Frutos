#!/usr/bin/env node

const fs = require("fs");
const path = require("path");
const { execSync } = require("child_process");

const folderPath = process.argv[2] || ".";
const option = process.argv[3] || "";

function convertToWebp(filePath) {
  const outputFilePath = `${filePath.split(".")[0]}.webp`;
  execSync(`cwebp "${filePath}" -o "${outputFilePath}"`);
  if (option === "a" || option === "all") {
    execSync(`rm ${filePath}`)
    
  }
  console.log(`Converted ${filePath} to WebP: ${outputFilePath}`);
}

function traverseDirectory(directoryPath = "./") {
  console.log("funcionei");
  fs.readdirSync(directoryPath).forEach((file) => {
    const filePath = path.join(directoryPath, file);
    const stat = fs.statSync(filePath);

    if (stat.isDirectory()) {
      traverseDirectory(filePath);
    } else {
      if (filePath.toLowerCase().match(/\.(png|jpg|jpeg)$/)) {
        convertToWebp(filePath);
      }
    }
  });
}

traverseDirectory(folderPath);
